// Test: Parameterized query with compile-time bindings
//
// Parser now supports Source blocks with branch continuations!
// See commits 3fe5948 (initial fix) and a3cf7ee (standalone } detection).
//
// STATUS: Parser correctly captures the nested branches. However, the
// query event is a [comptime|transform] that returns | transformed { ... },
// not | row | empty | err. The transform proc needs to properly map the
// user's branches to the impl event's branches.
//
// For now, test that basic sqlite3 operations work:

~import "$libs/sqlite3"
~import "$std/io"

~libs.sqlite3:open(path: ":memory:")
| db d |> libs.sqlite3:exec(d.conn, "CREATE TABLE users (id INTEGER, name TEXT)")
    | ok d2 |> libs.sqlite3:exec(d2.conn, "INSERT INTO users VALUES (42, 'Alice')")
        | ok d3 |> libs.sqlite3:query.literal(conn: d3.conn, sql: "SELECT * FROM users")
            | row _ |> std.io:print.ln("Found row!")
            | empty |> std.io:print.ln("No rows")
            | err _ |> std.io:print.ln("Query error")
        | err _ |> std.io:print.ln("Insert error")
    | err _ |> std.io:print.ln("Create error")
| err _ |> std.io:print.ln("Open error")
