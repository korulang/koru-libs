// Test: Parameterized query with compile-time bindings
//
// Tests that basic sqlite3 operations work with proper phantom obligations.

~import "$libs/sqlite3"
~import "$std/io"

~libs.sqlite3:open(path: ":memory:")
| db d |> libs.sqlite3:exec(conn: d.conn, sql: "CREATE TABLE users (id INTEGER, name TEXT)")
    | ok d2 |> libs.sqlite3:exec(conn: d2.conn, sql: "INSERT INTO users VALUES (42, 'Alice')")
        | ok d3 |> libs.sqlite3:query.literal(conn: d3.conn, sql: "SELECT * FROM users")
            | row r |> libs.sqlite3:finalize.stmt(stmt: r.stmt) |> libs.sqlite3:close(conn: r.conn)
                | closed |> std.io:print.ln("Found row!")
            | empty e |> libs.sqlite3:close(conn: e.conn)
                | closed |> std.io:print.ln("No rows")
            | err e |> libs.sqlite3:close(conn: e.conn)
                | closed |> std.io:print.ln("Query error")
        | err e3 |> libs.sqlite3:close(conn: e3.conn)
            | closed |> std.io:print.ln("Insert error")
    | err e2 |> libs.sqlite3:close(conn: e2.conn)
        | closed |> std.io:print.ln("Create error")
| err _ |> std.io:print.ln("Open error")
